# Концепция процесса разработки

## 1. Микропакетная архитектура

Каждый компонент оформлен как самостоятельный Python-пакет, который:

- управляет зависимостями через `uv`;
- может быть установлен стандартными инструментами — `pip`, `poetry`, `uv install`;
- собирается с помощью `hatchling` build-backend.

## 2. Три режима работы

Рабочее пространство (`workspace`) в **uv 0.7** использует **единый lock-файл** (`uv.lock`) и **одну виртуальную среду** `.venv` для всех компонентов.

Чтобы разделять окружения *dev*, *staging* и *prod*, держите для каждого собственный `pyproject.toml`:

- `pyproject.toml` — *dev*-сборка;
- `staging/pyproject.toml` — *staging*-сборка;
- `prod/pyproject.toml` — *prod*-сборка.

### dev — активная разработка

- пакеты подключаются локально в режиме *editable*;
- любые изменения в исходном коде сразу видны в окружении.

### staging — предрелизное тестирование

- фиксирует зависимости на dev-теги, готовые к ручному тестированию;
- окружение максимально близко к *prod*, но допускает полировку изменений.

### prod — подготовка к релизу / CI

- окружение собирается из опубликованных версий, отмеченных `git tag`;
- пакеты устанавливаются так же, как из PyPI, и не предполагают изменения кода.

## 3. Разделение репозиториев

Каждый пакет расположен в отдельном репозитории на GitHub.

Это обеспечивает:

- собственную историю коммитов, теги версий и ветки;
- изоляцию CI/CD-пайплайнов каждого пакета;
- возможность открывать Pull Request-ы независимо от основного проекта.

В корневом репозитории пакеты подключены как `git submodule`, что позволяет:

- выполнять привычные git-операции (`checkout`, `pull`, `log`, `tag`) прямо из корня проекта;
- фиксировать зависимость пакета на конкретный коммит;
- легко обновлять пакет до новой версии одной командой `git submodule update --remote`.

`submodule` выступает в роли «прокси» к чужому репозиторию: код пакета не содержится в истории основного проекта, но всегда под рукой.

## 4. Релизный процесс

Для сокращения рутины создан CLI-инструмент **`release_tool`** ([ссылка](https://github.com/VLMHyperBenchTeam/release_tool)), который:

- автоматически формирует коммиты, теги и GitHub-релизы;
- собирает *diff-файлы*, пригодные для генерации описаний релиза LLM-ами;
- поддерживает режим `--dry-run` для безопасной проверки.

## 5. Автоматическая сборка Docker-образа

В планах — CLI-команда, которая в режиме `prod` собирает оптимизированный Docker-образ на базе `prod/pyproject.toml` и фиксированного `uv.lock`.

Основная идея:

1. Многоступенчатая сборка (`builder` → `deps` → `runtime`).
1. На этапе `deps` — `uv sync --locked`.
1. В финальный слой копируются лишь скомпилированные зависимости и исходный код.
1. Скрипт `release_tool-stage7` автоматизирует генерацию Dockerfile и (опционально) пуш образа.
