# Выбор версии Python

Корневой `pyproject.toml` формально допускает диапазон версий:

```text
>=3.10, !=3.11.*, <3.13
```

Однако в реальном CI-процессе мы **всегда** закрепляем сборку под одну конкретную версию интерпретатора. Это упрощает кэширование и исключает неожиданные расхождения зависимостей между версиями.

## 1. Фиксация версии (обязательно)

```bash
uv python pin 3.12   # создаст/обновит .python-version
```

Файл `.python-version` хранится в корне репозитория и читается `uv` (а также `pyenv`, `asdf`, direnv и др.). После фиксации все дальнейшие команды `uv lock / uv sync / uv run` автоматически используют именно эту версию.

## 2. Генерация lock-файла и установка окружения

Выберите нужный CUDA-backend (см. 09_torch_backends.md) и выполните:

```bash
uv lock --extra cu124   # или cu128
uv sync --extra cu124   # или cu128
```

`uv lock` учтёт pinned-версию Python, поэтому параметр `--python` не требуется.

## 3. Смена версии при необходимости

1. Обновите файл pin:
   ```bash
   uv python pin 3.10
   ```
2. Пересчитайте lock-файл и переустановите окружение:
   ```bash
   uv lock --extra cu124
   uv sync --extra cu124
   ```

## Примечание о multi-Python lock

Если когда-нибудь понадобится один общий `uv.lock`, совместимый сразу с двумя версиями (например 3.10 и 3.12), можно **временно** убрать `.python-version` и запустить:

```bash
uv lock --python 3.10,3.12 --extra cu124
```

или воспользоваться режимом минимальных версий:

```bash
uv lock --resolution lowest-direct
```

Но для основного CI этот сценарий не применяется.

⚠️ В uv 0.7 параметр называется `--python`; флага `--python-version` нет.
